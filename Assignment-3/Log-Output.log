SQL> set pagesize 500
SQL> set linesize 1000
SQL> set wrap on
SQL> set feedback on
SQL> set echo on
SQL> COLUMN VENDOR_NAME FORMAT A20
SQL> COLUMN Loc_Bldg FORMAT A10
SQL> COLUMN Loc_Room FORMAT A10
SQL> COLUMN Comp_ID FORMAT A10
SQL> COLUMN Comp_Name FORMAT A10
SQL> 
SQL> --1
SQL> --replace the oldest 3 computers(first 3 computers purchased)
SQL> SELECT * FROM
  2  (SELECT Comp_ID, Comp_Name, Purchase_Date, Purchase_Price, Item_ID, Location_ID, Loc_Bldg, Loc_Room, Vendor_Name, RANK() OVER(ORDER BY Purchase_Date)as rank
  3  FROM COMPUTER JOIN LOCATION USING (Location_ID))
  4  WHERE rank <=3;

COMP_ID    COMP_NAME  PURCHASE_DAT PURCHASE_PRICE ITEM_ID  LOCA LOC_BLDG   LOC_ROOM   VENDOR_NAME                RANK                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
---------- ---------- ------------ -------------- -------- ---- ---------- ---------- -------------------- ----------                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
C8         Newell     07-APR-17               999 15       3    NSH        116        Best Buy                      1                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
C29        Goldeneye  03-MAY-17              3999 17       1    HBH        112        Apple Store                   2                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
C10        Caracas    15-MAY-17               999 15       2    HBH        116        Dell                          3                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   

3 rows selected.

SQL> 
SQL> --2
SQL> COLUMN ITEM_MANUF FORMAT A15
SQL> COLUMN ITEM_MODEL FORMAT A15
SQL> 
SQL> SELECT * FROM
  2  (SELECT COMP_ID, Comp_Name, Item_Manuf, Item_Model,ROUND(TOTAL_DAYS_ON_LOAN) AS TOTAL_DAYS_ON_LOAN, RANK() OVER(ORDER BY TOTAL_DAYS_ON_LOAN DESC) as rank
  3  FROM
  4  (SELECT COMP_ID, Comp_Name, Item_Manuf, Item_Model,SUM(DAYS_ON_LOAN) AS TOTAL_DAYS_ON_LOAN
  5  FROM(
  6  SELECT COMP_ID, Comp_Name, Item_Manuf, Item_Model,SUM(Date_Returned-Start_Date) AS DAYS_ON_LOAN
  7  FROM LOAN JOIN COMPUTER USING(COMP_ID)
  8  JOIN ITEM USING (Item_ID)
  9  WHERE Date_Returned IS NOT NULL
 10  GROUP BY COMP_ID,Comp_Name, Item_Manuf, Item_Model
 11  UNION
 12  SELECT COMP_ID,Comp_Name, Item_Manuf, Item_Model,SYSDATE - Start_Date AS DAYS_ON_LOAN
 13  FROM LOAN JOIN COMPUTER USING(COMP_ID)
 14  JOIN ITEM USING (Item_ID)
 15  WHERE Date_Returned IS NULL)
 16  GROUP BY COMP_ID,Comp_Name, Item_Manuf, Item_Model))
 17  WHERE rank <= 5;

COMP_ID    COMP_NAME  ITEM_MANUF      ITEM_MODEL      TOTAL_DAYS_ON_LOAN       RANK                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
---------- ---------- --------------- --------------- ------------------ ----------                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
C10        Caracas    Dell            XPS 13                         459          1                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
C28        Dinar      HP              Spectre                        421          2                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
C8         Newell     Dell            XPS 13                         381          3                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
C22        Azkaban    HP              Spectre                        365          4                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
C19        Simon      HP              Spectre                        361          5                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     

5 rows selected.

SQL> 
SQL> 
SQL> 
SQL> --3
SQL> column COMMENTS format A98
SQL> select Comp_ID, Comp_Name,Comments
  2  FROM COMPUTER JOIN ITEM USING (Item_ID)
  3  WHERE REGEXP_LIKE (Comments,'[3]\.[3-9]');

COMP_ID    COMP_NAME  COMMENTS                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          
---------- ---------- --------------------------------------------------------------------------------------------------                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
C21        Hobbit     804457 3.5GHz 6-Core Intel Xeon E5 Processor, 16GB 1866MHz DDR3 ECC memory, 256Gb PCIe-based flash                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                       storage.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
C25        Avatar     804457 3.5GHz 6-Core Intel Xeon E5 Processor, 16GB 1866MHz DDR3 ECC memory, 256Gb PCIe-based flash                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                       storage.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
C29        Goldeneye  804457 3.5GHz 6-Core Intel Xeon E5 Processor, 16GB 1866MHz DDR3 ECC memory, 256Gb PCIe-based flash                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                       storage.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
C32        Stargate   805023 3.3GHz quad-core Intel Core i5 processor, Turbo boost up to 3.9GHz, 8GB memory, 2TB Fusion                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
                      Drive, AMD Radeon R9 M395 with 2GB video memory, Retina 5K 5120-by-2880 P3 display                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
C34        Koala      805023 3.3GHz quad-core Intel Core i5 processor, Turbo boost up to 3.9GHz, 8GB memory, 2TB Fusion                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
                      Drive, AMD Radeon R9 M395 with 2GB video memory, Retina 5K 5120-by-2880 P3 display                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        

5 rows selected.

SQL> 
SQL> --4
SQL> COLUMN St_LName FORMAT A10
SQL> COLUMN St_FName FORMAT A10
SQL> COLUMN St_FName FORMAT A10
SQL> SELECT st_id, St_LName, St_FName,NUMBER_OF_LOAN,DENSE_RANK() OVER(ORDER BY NUMBER_OF_LOAN DESC) AS NUMBER_OF_LOAN_RANK, ROUND(DAYS_OF_LOAN) AS DAYS_OF_LOAN,DENSE_RANK() OVER(ORDER BY DAYS_OF_LOAN DESC) AS DAYS_OF_LOAN_RANK
  2  FROM
  3  (SELECT st_id, St_LName, St_FName, COUNT(LOAN_ID) AS NUMBER_OF_LOAN, SUM(NVL(Date_Returned,SYSDATE)-Start_Date)AS DAYS_OF_LOAN
  4  FROM STUDENT JOIN LOAN USING (St_ID)
  5  GROUP BY st_id, St_LName, St_FName
  6  UNION
  7  SELECT st_id, St_LName, St_FName,0,0
  8  FROM STUDENT
  9  WHERE st_id NOT IN (SELECT st_id FROM LOAN));

ST_ID    ST_LNAME   ST_FNAME   NUMBER_OF_LOAN NUMBER_OF_LOAN_RANK DAYS_OF_LOAN DAYS_OF_LOAN_RANK                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
-------- ---------- ---------- -------------- ------------------- ------------ -----------------                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
238      Johnson    Richard                 3                   3          620                 1                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
207      Guerra     Richard                 3                   3          449                 2                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
241      Singh      Vijay                   2                   4          443                 3                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
213      Miller     Sandra                  3                   3          361                 4                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
360      Bevens     John                    4                   2          357                 5                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
323      Nimoy      Joan                    2                   4          341                 6                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
362      Couples    Fred                    5                   1          304                 7                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
231      Holin      John                    3                   3          266                 8                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
437      Young      James                   2                   4          234                 9                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
320      Tavernier  Anna                    3                   3          132                10                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
425      Pepper     Angela                  1                   5           89                11                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
416      Price      Michael                 1                   5           89                12                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
407      Lee        Bing                    0                   6            0                13                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
450      Sanchez    Ruben                   0                   6            0                13                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        

14 rows selected.

SQL> 
SQL> 
SQL> --5
SQL> COLUMN Comp_ID FORMAT A25
SQL> COLUMN Comp_Name FORMAT A25
SQL> SELECT st_id, St_LName, St_FName,Comp_ID, Comp_Name,ROUND(duration) AS duration
  2  FROM(
  3  SELECT st_id, St_LName, St_FName,Comp_ID, Comp_Name, duration,MAX(duration) OVER (partition by st_id) LONGEST
  4  FROM(
  5  SELECT st_id, St_LName, St_FName,Comp_ID, Comp_Name, NVL(Date_Returned-Start_Date,SYSDATE - Start_Date) as duration
  6  FROM STUDENT JOIN LOAN USING (st_id)
  7  JOIN COMPUTER USING (Comp_ID)))
  8  WHERE duration = LONGEST
  9  union
 10  SELECT st_id, St_LName, St_FName,'N/A: Rent No Computer','N/A: Rent No Computer',0
 11  FROM STUDENT
 12  WHERE st_id NOT IN (SELECT st_id FROM LOAN)
 13  ORDER BY duration DESC;

ST_ID    ST_LNAME   ST_FNAME   COMP_ID                   COMP_NAME                   DURATION                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           
-------- ---------- ---------- ------------------------- ------------------------- ----------                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           
241      Singh      Vijay      C22                       Azkaban                          362                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           
238      Johnson    Richard    C10                       Caracas                          272                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           
213      Miller     Sandra     C19                       Simon                            248                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           
207      Guerra     Richard    C18                       Bell                             234                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           
323      Nimoy      Joan       C28                       Dinar                            206                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           
437      Young      James      C36                       Xeon                             196                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           
360      Bevens     John       C8                        Newell                           193                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           
231      Holin      John       C29                       Goldeneye                        170                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           
362      Couples    Fred       C35                       Kinetic                          132                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           
320      Tavernier  Anna       C8                        Newell                            89                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           
416      Price      Michael    C32                       Stargate                          89                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           
425      Pepper     Angela     C30                       Barnaby                           89                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           
407      Lee        Bing       N/A: Rent No Computer     N/A: Rent No Computer              0                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           
450      Sanchez    Ruben      N/A: Rent No Computer     N/A: Rent No Computer              0                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           

14 rows selected.

SQL> 
SQL> 
SQL> --6
SQL> SELECT Comp_ID,comp_name,St_ID,St_LName, St_FName,DAYS_SINCE_STARTED,NUMBER_OF_TIMES_RENTED
  2  FROM
  3  (SELECT St_ID,St_LName, St_FName,Comp_ID,comp_name,ROUND(SYSDATE-Start_Date) AS DAYS_SINCE_STARTED
  4  FROM STUDENT JOIN LOAN USING (St_ID)
  5  JOIN COMPUTER USING (COMP_ID)
  6  WHERE Date_Returned IS NULL)
  7  JOIN
  8  (SELECT COMP_ID,COUNT(Loan_ID) AS NUMBER_OF_TIMES_RENTED
  9  FROM LOAN
 10  WHERE COMP_ID IN(
 11  SELECT COMP_ID
 12  FROM LOAN
 13  WHERE Date_Returned IS NULL)
 14  GROUP BY COMP_ID) USING (COMP_ID)
 15  ORDER BY DAYS_SINCE_STARTED DESC;

COMP_ID                   COMP_NAME                 ST_ID    ST_LNAME   ST_FNAME   DAYS_SINCE_STARTED NUMBER_OF_TIMES_RENTED                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
------------------------- ------------------------- -------- ---------- ---------- ------------------ ----------------------                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
C22                       Azkaban                   241      Singh      Vijay                     362                      2                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
C28                       Dinar                     207      Guerra     Richard                   215                      2                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
C10                       Caracas                   238      Johnson    Richard                   187                      2                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
C25                       Avatar                    231      Holin      John                       96                      2                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
C19                       Simon                     213      Miller     Sandra                     92                      3                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
C30                       Barnaby                   425      Pepper     Angela                     89                      3                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
C8                        Newell                    320      Tavernier  Anna                       89                      5                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
C32                       Stargate                  416      Price      Michael                    89                      1                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
C21                       Hobbit                    360      Bevens     John                       71                      3                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
C18                       Bell                      362      Couples    Fred                       69                      3                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            

10 rows selected.

SQL> 
SQL> --7
SQL>  -- NEVER ON LOAN
SQL> SELECT COMP_ID, COMP_NAME, PURCHASE_DATE, ITEM_ID, VENDOR_NAME, ROUND(SYSDATE - PURCHASE_DATE) AS AVG_downtime
  2  FROM COMPUTER LEFT OUTER JOIN LOAN USING (COMP_ID)
  3  WHERE LOAN_ID IS NULL
  4  UNION
  5  --CURRENLY ON LOAN:
  6  SELECT COMP_ID, COMP_NAME, PURCHASE_DATE, ITEM_ID, VENDOR_NAME, ROUND(AVG(START_DATE-LAST_RETURN)) AS AVG_downtime
  7  FROM(
  8  SELECT COMP_ID, COMP_NAME, PURCHASE_DATE, PURCHASE_PRICE, ITEM_ID, VENDOR_NAME, LOAN_ID, ST_ID, START_DATE, DATE_RETURNED,
  9  LAG(Date_Returned,1,PURCHASE_DATE) OVER (PARTITION BY Comp_ID ORDER BY Start_Date) AS LAST_RETURN
 10  FROM COMPUTER JOIN LOAN USING (COMP_ID)
 11  ORDER BY Comp_ID,Start_Date)
 12  WHERE Comp_ID IN (SELECT Comp_ID FROM LOAN WHERE DATE_RETURNED IS NULL)
 13  GROUP BY COMP_ID, COMP_NAME, PURCHASE_DATE, ITEM_ID, VENDOR_NAME
 14  --ON LOAN BEFORE BUT CURRENLY NOT ON LOAN:
 15  UNION
 16  SELECT COMP_ID, COMP_NAME, PURCHASE_DATE, ITEM_ID, VENDOR_NAME, ROUND(AVG(DOWNTIME)) AS AVG_downtime
 17  FROM(
 18  SELECT COMP_ID, COMP_NAME, PURCHASE_DATE, ITEM_ID, VENDOR_NAME, START_DATE - LAST_RETURN AS DOWNTIME
 19  FROM
 20  (SELECT COMP_ID, COMP_NAME, PURCHASE_DATE, ITEM_ID, VENDOR_NAME, START_DATE, DATE_RETURNED,
 21  LAG(Date_Returned,1,PURCHASE_DATE) OVER (PARTITION BY Comp_ID ORDER BY Start_Date) AS LAST_RETURN
 22  FROM COMPUTER JOIN LOAN USING (COMP_ID)
 23  WHERE Comp_ID NOT IN (SELECT Comp_ID FROM LOAN WHERE DATE_RETURNED IS NULL))
 24  UNION
 25  SELECT DISTINCT COMP_ID, COMP_NAME, PURCHASE_DATE, ITEM_ID, VENDOR_NAME,SYSDATE - MAX(DATE_RETURNED) AS DOWNTIME
 26  FROM COMPUTER JOIN LOAN USING (COMP_ID)
 27  WHERE Comp_ID NOT IN (SELECT Comp_ID FROM LOAN WHERE DATE_RETURNED IS NULL)
 28  GROUP BY COMP_ID, COMP_NAME, PURCHASE_DATE, ITEM_ID, VENDOR_NAME)
 29  GROUP BY COMP_ID, COMP_NAME, PURCHASE_DATE, ITEM_ID, VENDOR_NAME;

COMP_ID                   COMP_NAME                 PURCHASE_DAT ITEM_ID  VENDOR_NAME          AVG_DOWNTIME                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
------------------------- ------------------------- ------------ -------- -------------------- ------------                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
C10                       Caracas                   15-MAY-17    15       Dell                           51                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
C18                       Bell                      25-JUN-17    19       HP                             72                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
C19                       Simon                     25-JUN-17    19       HP                             53                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
C21                       Hobbit                    07-JUN-17    17       Campus Store                  117                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
C22                       Azkaban                   02-NOV-17    19       HP                             13                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
C25                       Avatar                    02-NOV-17    17       Campus Store                   67                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
C28                       Dinar                     25-JUN-17    19       HP                             50                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
C29                       Goldeneye                 03-MAY-17    17       Apple Store                    53                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
C30                       Barnaby                   25-JUN-17    15       Dell                           99                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
C32                       Stargate                  16-AUG-18    23       Apple Store                    14                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
C33                       Cloud                     16-AUG-18    19       HP                            104                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
C34                       Koala                     16-AUG-18    23       Apple Store                   104                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
C35                       Kinetic                   16-AUG-17    27       Best Buy                      168                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
C36                       Xeon                      06-SEP-17    29       Apple Store                   126                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
C8                        Newell                    07-APR-17    15       Best Buy                       44                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             

15 rows selected.

SQL> 
SQL> 
SQL> 
SQL> --Bonus
SQL> --DEFINE SEMESTER:
SQL> --SEMESTER 1: JANUARY TO APRIL
SQL> --SEMESTER 2: MAY TO AUGUST
SQL> --SEMESTER 3: SEPTEMBER TO DECEMBER
SQL> COLUMN NUMBER_OF_LOANS_INITIATED FORMAT A30
SQL> SELECT decode(SEMESTER_PROGRAM,'SEMESTER','PROGRAM_TOTAL',SEMESTER_PROGRAM) AS NUMBER_OF_LOANS_INITIATED, COMPFIN, HNZECON, HNZIS, COMPFIN+HNZECON+HNZIS AS SEMESTER_TOTAL
  2  FROM
  3  (SELECT NVL('SEMESTER'||semester, 'Program_Total') AS SEMESTER_PROGRAM,
  4  sum(decode(TRIM(Prog_ID),'COMPFIN',NUMBER_OF_LOAN,0)) as "COMPFIN",
  5  sum(decode(TRIM(Prog_ID),'HNZECON',NUMBER_OF_LOAN,0)) as "HNZECON",
  6  sum(decode(TRIM(Prog_ID),'HNZIS',NUMBER_OF_LOAN,0)) as "HNZIS"
  7  FROM
  8  (SELECT B.Prog_ID, B.semester,count(Loan_ID) AS NUMBER_OF_LOAN
  9  FROM
 10  (SELECT Loan_ID,Prog_ID,semester
 11  FROM
 12  (SELECT Loan_ID, St_ID,Prog_ID, Comp_ID,
 13     CASE WHEN EXTRACT(YEAR FROM Start_Date) = EXTRACT(YEAR FROM SYSDATE)-1 AND EXTRACT(MONTH FROM Start_Date) BETWEEN 1 AND 4 THEN 1
 14  WHEN EXTRACT(YEAR FROM Start_Date) = EXTRACT(YEAR FROM SYSDATE)-1 AND EXTRACT(MONTH FROM Start_Date) BETWEEN 5 AND 8 THEN 2
 15  WHEN EXTRACT(YEAR FROM Start_Date) = EXTRACT(YEAR FROM SYSDATE)-1 AND EXTRACT(MONTH FROM Start_Date) BETWEEN 9 AND 12 THEN 3
 16  END AS semester
 17  FROM LOAN JOIN STUDENT USING (St_ID)
 18    JOIN PROGRAM USING (Prog_ID))
 19  WHERE semester IS NOT NULL) A RIGHT OUTER JOIN (SELECT semester,Prog_ID from(SELECT 0+level as semester FROM dual CONNECT BY level <= 3), PROGRAM) B ON A.semester = B.semester AND A.Prog_ID = B.Prog_ID
 20  GROUP BY GROUPING SETS((B.Prog_ID, B.semester))
 21  ORDER BY B.Prog_ID, B.semester)
 22  GROUP BY GROUPING SETS (semester,()));

NUMBER_OF_LOANS_INITIATED         COMPFIN    HNZECON      HNZIS SEMESTER_TOTAL                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          
------------------------------ ---------- ---------- ---------- --------------                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          
SEMESTER1                               0          0          0              0                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          
SEMESTER2                               6          1          4             11                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          
SEMESTER3                               5          1          3              9                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          
PROGRAM_TOTAL                          11          2          7             20                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          

4 rows selected.

SQL> spool out
